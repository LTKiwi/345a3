<!DOCTYPE html>
<html lang="en">
<title>Assignment 3 Base code Adapted from W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link href='https://fonts.googleapis.com/css?family=RobotoDraft' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><style>
html,body,h1,h2,h3,h4,h5 {font-family: "RobotoDraft", "Roboto", sans-serif}
.w3-bar-block .w3-bar-item {padding: 16px}

.container {
	display: block;
	position: relative;
	padding-left: 25px;
	margin-bottom: 12px;
	cursor: pointer;
	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;
}

/* Hide the browser's default radio button */
.container input {
	position: absolute;
	opacity: 0;
	cursor: pointer;
}

/* Create a custom radio button */
.checkmark {
	position: absolute;
	top: 0;
	left: 0;
	height: 20px;
	width: 20px;
	background-color: #eee;
	border-radius: 50%;
}

/* On mouse-over, add a grey background color */
.container:hover input ~ .checkmark {
	background-color: #ccc;
}

/* When the radio button is checked, add a blue background */
.container input:checked ~ .checkmark {
	background-color: #2196F3;
}

/* Create the indicator (the dot/circle - hidden when not checked) */
.checkmark:after {
	content: "";
	position: absolute;
	display: none;
}

/* Show the indicator (dot/circle) when checked */
.container input:checked ~ .checkmark:after {
	display: block;
}

/* Style the indicator (dot/circle) */
.container .checkmark:after {
	top: 5px;
	left: 5px;
	width: 9px;
	height: 9px;
	border-radius: 50%;
	background: white;
}


</style>
<body>

	<!-- Side Navigation -->
	<nav class="w3-sidebar w3-bar-block w3-collapse w3-white w3-animate-left w3-card" style="z-index:3;width:320px;" id="mySidebar">
		<a href="javascript:void(0)" class="w3-bar-item w3-button w3-border-bottom w3-large"><i class="fa fa-edit"></i> &nbsp; Assignment 3 template <br/> based on
			<span><img src="https://www.w3schools.com/images/w3schools.png" style="width:30%"></span> template</a>
			<a href="javascript:void(0)" onclick="w3_close()" title="Close Sidemenu" 
			class="w3-bar-item w3-button w3-hide-large w3-large">Close <i class="fa fa-remove"></i></a>
			<a href="javascript:void(0)" class="w3-bar-item w3-button w3-dark-grey w3-button w3-hover-black w3-left-align" onclick="document.getElementById('id01').style.display='block'">Share File <i class="w3-padding fa fa-pencil"></i></a>
			<a id="myBtn" onclick="myFunc('Demo1')" href="javascript:void(0)" class="w3-bar-item w3-button"><i class="fa fa-inbox w3-margin-right"></i>Files (3)<i class="fa fa-caret-down w3-margin-left"></i></a>
			<div id="Demo1" class="w3-hide w3-animate-left">
				<a href="javascript:void(0)" class="w3-bar-item w3-button w3-border-bottom contentnav w3-hover-light-grey" onclick="openContent('File1');w3_close();" id="firstTab">
					<div class="w3-container">
						<img class="w3-round w3-margin-right" src="./fileIcon3.png" style="width:15%;"><span class="w3-opacity w3-large">File 1</span>
						<h6>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</h6>
						<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
					</div>
				</a>
				<a href="javascript:void(0)" class="w3-bar-item w3-button w3-border-bottom contentnav w3-hover-light-grey" onclick="openContent('File2');w3_close();">
					<div class="w3-container">
						<img class="w3-round w3-margin-right" src="./fileIcon5.png" style="width:15%;"><span class="w3-opacity w3-large">File 2</span>
						<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
					</div>
				</a>
				<a href="javascript:void(0)" class="w3-bar-item w3-button w3-border-bottom contentnav w3-hover-light-grey" onclick="openContent('File3');w3_close();">
					<div class="w3-container">
						<img class="w3-round w3-margin-right" src="./fileIcon2.png" style="width:15%;"><span class="w3-opacity w3-large">File 3</span>
						<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
					</div>
				</a>
			</div>
			<a href="#" class="w3-bar-item w3-button"><i class="fa fa-paper-plane w3-margin-right"></i>Shared Files</a>
			<a id="groupButton" onclick="myFunc('groupList')" href="javascript:void(0)" class="w3-bar-item w3-button"><i class="fa fa-users w3-margin-right"></i>Groups<i class="fa fa-caret-down w3-margin-left"></i></a>
			<div id="groupList" class="w3-hide w3-animate-left">
				<!--Populated by setupGroup function -->
			</div> 
			<a href="#" class="w3-bar-item w3-button"><i class="fa fa-hourglass-end w3-margin-right"></i>Draft Files</a>
			<a href="#" class="w3-bar-item w3-button"><i class="fa fa-trash w3-margin-right"></i>Trash</a>
		</nav>

		<!-- Modal that pops up when you click on "Share File" general -->
		<div id="id01" class="w3-modal" style="z-index:4">
			<div class="w3-modal-content w3-animate-zoom">
				<div class="w3-container w3-padding w3-red">
					<span onclick="document.getElementById('id01').style.display='none'"
					class="w3-button w3-red w3-right w3-xxlarge"><i class="fa fa-remove"></i></span>
					<h2>Share File</h2>
				</div>
				<div class="w3-panel">
					<label>To</label>
					<input class="w3-input w3-border w3-margin-bottom" type="text">
					<label>From</label>
					<input class="w3-input w3-border w3-margin-bottom" type="text" disabled value="bsha259@aucklanduni.ac.nz">
					<label>File</label>
					<select class="w3-input w3-border w3-margin-bottom">
						<option style="display: none">Select a File...</option>
						<option value="File1">
							File 1
						</option>
						<option value="File2">
							File 2
						</option>
						<option value="File3">
							File 3
						</option>
					</select>
					<div>
						<label>File Permissions</label>
						<div>
							<label class="container">Viewing
								<input type="radio" checked="checked" name="radio">
								<span class="checkmark"></span>
							</label>
							<label class="container"> Editing
								<input type="radio" name="radio">
								<span class="checkmark"></span>
							</label>
						</div>
					</div>
					<input class="w3-input w3-border w3-margin-bottom" style="height:150px" placeholder="Message">
					<div class="w3-section">
						<a class="w3-button w3-red" onclick="document.getElementById('id01').style.display='none'">Cancel  <i class="fa fa-remove"></i></a>
						<a class="w3-button w3-light-grey w3-right" onclick="document.getElementById('id01').style.display='none'">Share  <i class="fa fa-paper-plane"></i></a> 
					</div>    
				</div>
			</div>
		</div>

		<!-- Modal that pops up when you click on "Share File" with selected File-->
		<div id="id02" class="w3-modal" style="z-index:4">
			<div class="w3-modal-content w3-animate-zoom">
				<div class="w3-container w3-padding w3-red">
					<span onclick="document.getElementById('id02').style.display='none'"
					class="w3-button w3-red w3-right w3-xxlarge"><i class="fa fa-remove"></i></span>
					<h2>Share File</h2>
				</div>
				<div class="w3-panel">
					<label>To</label>
					<input class="w3-input w3-border w3-margin-bottom" type="text">
					<label>From</label>
					<input class="w3-input w3-border w3-margin-bottom" type="text" disabled value="bsha259@aucklanduni.ac.nz">
					<label>File</label>
					<input id="selFileInput" class="w3-input w3-border w3-margin-bottom" type="text" disabled value="">
					<div>
						<label>File Permissions</label>
						<div>
							<label class="container">Viewing
								<input type="radio" checked="checked" name="radio">
								<span class="checkmark"></span>
							</label>
							<label class="container"> Editing
								<input type="radio" name="radio">
								<span class="checkmark"></span>
							</label>
						</div>
					</div>
					<input class="w3-input w3-border w3-margin-bottom" style="height:150px" placeholder="Message">
					<div class="w3-section">
						<a class="w3-button w3-red" onclick="document.getElementById('id02').style.display='none'">Cancel  <i class="fa fa-remove"></i></a>
						<a class="w3-button w3-light-grey w3-right" onclick="document.getElementById('id02').style.display='none'">Share  <i class="fa fa-paper-plane"></i></a> 
					</div>    
				</div>
			</div>
		</div>

		<!-- Modal for Adding a Group -->
		<div id="id03" class="w3-modal" style="z-index:4">
			<div class="w3-modal-content w3-animate-zoom">
				<div class="w3-container w3-padding w3-red">
					<span onclick="document.getElementById('id03').style.display='none'"
					class="w3-button w3-red w3-right w3-xxlarge"><i class="fa fa-remove"></i></span>
					<h2>Create New Group</h2>
				</div>
				<div class="w3-panel">
					<label>Group Name</label>
					<input class="w3-input w3-border w3-margin-bottom" type="text">
					<label>Group Users</label>
					<input class="w3-input w3-border w3-margin-bottom" style="height:150px" placeholder="Comma seperated list">
					<div class="w3-section">
						<a class="w3-button w3-red" onclick="document.getElementById('id03').style.display='none'">Cancel  <i class="fa fa-remove"></i></a>
						<a class="w3-button w3-light-grey w3-right" onclick="document.getElementById('id03').style.display='none'">Create Group <i class="fa fa-plus"></i></a> 
					</div>    
				</div>
			</div>
		</div>

		<!-- Overlay effect when opening the side navigation on small screens -->
		<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="Close Sidemenu" id="myOverlay"></div>

		<!-- Page content -->
		<div id="contentcontainer" class="w3-main" style="margin-left:320px;">
			<i class="fa fa-bars w3-button w3-white w3-hide-large w3-xlarge w3-margin-left w3-margin-top" onclick="w3_open()"></i>
			<a href="javascript:void(0)" class="w3-hide-large w3-red w3-button w3-right w3-margin-top w3-margin-right" onclick="document.getElementById('id01').style.display='block'"><i class="fa fa-pencil"></i></a>

			<div id="File1" class="w3-container content">
				<br>
				<img class="w3-round  w3-animate-top" src="./fileIcon3.png" style="width:20%;">
				<h5 class="w3-opacity">File 1</h5>
				<h4><i class="fa fa-clock-o"></i> File 1, Sep 27, 2015.</h4>
				<a class="w3-button w3-light-grey" href="#" onclick="shareSelected('File1')">Share<i class="w3-margin-left fa fa-mail-reply"></i></a>
				<a class="w3-button w3-light-grey" href="#">Delete<i class="w3-margin-left fa fa-arrow-right"></i></a>
				<hr>

				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
				<div id="File1shared" ></div>
			</div>

			<div id="File2" class="w3-container content">
				<br>
				<img class="w3-round w3-animate-top" src="./fileIcon5.png" style="width:20%;">
				<h5 class="w3-opacity">File 2</h5>
				<h4><i class="fa fa-clock-o"></i> File 2, Sep 25, 2015.</h4>
				<a class="w3-button w3-light-grey" onclick="shareSelected('File2')">Share<i class="w3-margin-left fa fa-mail-reply"></i></a>
				<a class="w3-button w3-light-grey">Delete<i class="w3-margin-left fa fa-arrow-right"></i></a>
				<hr>
				<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
				<div id="File2shared" ></div>

			</div>

			<div id="File3" class="w3-container content">
				<br>
				<img class="w3-round w3-animate-top" src="./fileIcon2.png" style="width:20%;">
				<h5 class="w3-opacity">File 3</h5>
				<h4><i class="fa fa-clock-o"></i> File 3, Sep 23, 2015.</h4>
				<a class="w3-button w3-light-grey" onclick="shareSelected('File3')">Share<i class="w3-margin-left fa fa-mail-reply"></i></a>
				<a class="w3-button w3-light-grey">Delete<i class="w3-margin-left fa fa-arrow-right"></i></a>
				<hr>
				<div id="File3shared" ></div>
			</div>
			<!-- Groups are populated here by setupGroup which calls setupGroupContent -->

		</div>

		<script>
			var openInbox = document.getElementById("myBtn");
			openInbox.click();


let files ={
	"File 1":{
		img:'./fileIcon3.png',
		permissions:{
			'345 A2': 'Viewing'
		}
	},
	"File 2":{
		img:'./fileIcon5.png',
		permissions:{
			'personal@gmail.com':'Editing',


		}
	},
	"File 3":{
		img:'./fileIcon2.png',
		permissions:{
			'345 A2': 'Editing',
			'tutor@uni.ac.nz':'Viewing'
		}
	}
}

let groups = {
	"345 A2": {
		users:["trs123@aucklanduni.ac.nz", "caug321@aucklanduni.ac.nz"]
	},
	"CulinaryArtsGroup1":{
		users:["jsmith@mail.com", "janedoe@email.org", "karen@roberts.nz"]
	}
}



//4357 4500 5389 1014
//06/23
//S HUNTER 

function removeGroupUser(group,name){
	groups[group].users = groups[group].users.filter(function(ele){
								return ele != name;
							});

}

function updatePermission(file, permission, target){

	files[file].permissions[target]=permission
}

function removeDOMelement(el){
  	el.remove();
}

function removeGroup(group){
	let content = document.getElementById(group.replace(" ",""))
	let navmenu = document.getElementById(`${group.replace(" ","")}nav`)
	removeDOMelement(content)
	removeDOMelement(navmenu)

	for (let x in files){
		delete files[x].permissions[group]
	}
	delete groups[group]
}

function addGroupUser(group, user){
	let inputDOM = document.getElementById(group.replace(" ","")+'add')
	let insertPoint = inputDOM.parentElement
	let newuser= inputDOM.value
	let userHTML = `<div style="display:flex">
						<h5 class="w3-third">${newuser}</h5> <a class="w3-button w3-light-grey w3-hover-pale-red" href="#" onclick="removeGroupUser('${group}','${newuser}'); removeDOMelement(this.parentElement)">Remove User<i class="w3-margin-left fa fa-user-times"></i></a>
					</div>`
	if(newuser.length>0){
		insertPoint.insertAdjacentHTML("beforebegin", userHTML)
		groups[group].users.push(newuser)	
	}
	inputDOM.value=""
}


function setupGroupContent(group, groupLabel){
	//delete current div with ID of group if exists, then reform it.
	let existingcontent= document.getElementById(groupLabel.replace(" ", ""))	
	let groupusers = ""
	for (let x of group.users){
		groupusers+=`<div style="display:flex">
						<h5 class="w3-third">${x}</h5> <a class="w3-button w3-light-grey w3-hover-pale-red" href="#" onclick="removeGroupUser('${groupLabel}','${x}'); removeDOMelement(this.parentElement)">Remove User<i class="w3-margin-left fa fa-user-times"></i></a>
					</div>`
	}
	groupusers+=`<div style="display:flex">
					<input class="w3-input w3-border w3-third" type="text" placeholder="Type email..." id="${groupLabel.replace(" ", "")}add"><a class="w3-button w3-light-grey w3-hover-pale-green" href="#" onclick="addGroupUser('${groupLabel}');">Add User<i class="w3-margin-left fa fa-user-plus"></i></a>
				</div>`

	let groupfiles =""
	for (let x in files){
		if(files[x].permissions[groupLabel]=='Viewing'){
			groupfiles+=`<div style="padding:0.2em">
							<h4><img class="w3-round w3-margin-right" src="${files[x].img}" style="width:1.5em;">${x}</h4>
							<label>File Permissions</label>
								<div>
									<label class="container">Viewing
										<input type="radio" checked="checked" name="radio${x}" onclick="updatePermission('${x}','Viewing','${groupLabel}')">
										<span class="checkmark"></span>
									</label>
									<label class="container"> Editing
										<input type="radio" name="radio${x}" onclick="updatePermission('${x}','Editing','${groupLabel}')">
										<span class="checkmark"></span>
									</label>
								</div>
							<a class="w3-button w3-light-grey" href="#">Stop Sharing<i class="w3-margin-left fa fa-times"></i></a>
						</div>`
		}
		if(files[x].permissions[groupLabel]=='Editing'){
			groupfiles+=`<div style="padding:0.2em">
							<h4><img class="w3-round w3-margin-right" src="${files[x].img}" style="width:1.5em;">${x}</h4>
							<label>File Permissions</label>
								<div>
									<label class="container">Viewing
										<input type="radio" name="radio${x}" onclick="updatePermission('${x}','Viewing','${groupLabel}')">
										<span class="checkmark"></span>
									</label>
									<label class="container"> Editing
										<input type="radio" checked="checked" name="radio${x}" onclick="updatePermission('${x}','Editing','${groupLabel}')">
										<span class="checkmark"></span>
									</label>
								</div>
							<a class="w3-button w3-light-grey" href="#">Stop Sharing<i class="w3-margin-left fa fa-times"></i></a>
						</div>`
		}
	}
	if(groupfiles.length==0){
		groupfiles=`<h5 class="w3-opacity">No Files Shared</h5>`
	}
	let insertPoint = document.getElementById("contentcontainer")
	let insertHTML = `
		<br>
		<h4 >${groupLabel}</h4>
		<a class="w3-button w3-light-grey" href="#" onclick="removeGroup('${groupLabel}')">Delete Group<i class="w3-margin-left fa fa-trash"></i></a>
		<div class="w3-opacity groupusers">
			${groupusers}
		</div>
		<hr>
		<h4> Shared Files: </h4>
		<div class="groupfiles" style="display:flex">
			${groupfiles}
		</div>

		<hr>

	`
	if(existingcontent!==null){
		existingcontent.innerHTML=insertHTML
	}else{
		insertPoint.insertAdjacentHTML('beforeend', `<div id="${groupLabel.replace(" ","")}" class="w3-container content" style="display:none">`+insertHTML+`</div>`)
	}	
	
}

function setupGroups(){
	//navbar list
	document.getElementById("groupList").innerHTML="" //set to blank inititally
	for (let x in groups){
		document.getElementById("groupList").innerHTML+= `
		<a href="javascript:void(0)" class="w3-bar-item w3-button w3-border-bottom contentnav w3-hover-light-grey" id="${x.replace(" ","")}nav" onclick="openContent('${x.replace(" ","")}');w3_close();">
			<div class="w3-container">
				<span class="w3-opacity w3-large">${x}</span>
			</div>
		</a>`//create Nav Menu in group tab
		setupGroupContent(groups[x], x) //create content page for group
	}
	//Add Group Button
	document.getElementById("groupList").innerHTML+= `
		<a href="javascript:void(0)" class="w3-bar-item w3-button w3-border-bottom contentnav w3-hover-pale-green" onclick="document.getElementById('id03').style.display='block'";w3_close();">
			<div class="w3-container">
				<span ><i class="fa fa-plus w3-margin-right"></i>Add Group</span>
			</div>
		</a>`
	//file content lists
	for (let x in files){
		let filesharelist = document.getElementById(`${x.replace(" ","")}shared`)
		filesharelist.innerHTML=""
		if(Object.keys(files[x].permissions).length){
			filesharelist.innerHTML=`<h4>Shared with</h4>`
			let insertHTML=`<div style="display:flex">`
			for (let y in files[x].permissions){
				let icon ="fa-user"
				if(y in groups){
					icon="fa-users"	
				}
				if (files[x].permissions[y]=='Viewing'){
					insertHTML+=`<div style="padding:0.2em">
									<b><i class="fa ${icon}"></i>  ${y}</b>
									<div>
										<label class="container">Viewing
											<input type="radio" checked="checked" name="radio${x+y}" onclick="updatePermission('${x}','Viewing','${y}')">
											<span class="checkmark"></span>
										</label>
										<label class="container"> Editing
											<input type="radio" name="radio${x+y}" onclick="updatePermission('${x}','Editing','${y}')">
											<span class="checkmark"></span>
										</label>
									</div>
									<a class="w3-button w3-light-grey" href="#">Stop Sharing<i class="w3-margin-left fa fa-times"></i></a>
								</div>`
				}else{
					insertHTML+=`<div style="padding:0.2em">
									<b><i class="fa ${icon}"></i>  ${y}</b>
									<div>
										<label class="container">Viewing
											<input type="radio" name="radio${x+y}" onclick="updatePermission('${x}','Viewing','${y}')">
											<span class="checkmark"></span>
										</label>
										<label class="container"> Editing
											<input type="radio" checked="checked" name="radio${x+y}" onclick="updatePermission('${x}','Editing','${y}')">
											<span class="checkmark"></span>
										</label>
									</div>
									<a class="w3-button w3-light-grey" href="#">Stop Sharing<i class="w3-margin-left fa fa-times"></i></a>
								</div>`
				}
			}
			filesharelist.insertAdjacentHTML('beforeend',`${insertHTML}</div>`)	
		}

	}

}



function w3_open() {
	document.getElementById("mySidebar").style.display = "block";
	document.getElementById("myOverlay").style.display = "block";
}

function w3_close() {
	document.getElementById("mySidebar").style.display = "none";
	document.getElementById("myOverlay").style.display = "none";
}

function myFunc(id) {
	var x = document.getElementById(id);
	if (x.className.indexOf("w3-show") == -1) {
		x.className += " w3-show"; 
		x.previousElementSibling.className += " w3-red";
	} else { 
		x.className = x.className.replace(" w3-show", "");
		x.previousElementSibling.className = 
		x.previousElementSibling.className.replace(" w3-red", "");
	}
}

openContent("File1")
function openContent(contentName) {
	var i;
	var x = document.getElementsByClassName("content");
	for (i = 0; i < x.length; i++) {
		x[i].style.display = "none";
	}

	x = document.getElementsByClassName("contentnav");
	for (i = 0; i < x.length; i++) {
		x[i].className = x[i].className.replace(" w3-light-grey", "");
	}
	document.getElementById(contentName).style.display = "block";
	event.currentTarget.className += " w3-light-grey";
	setupGroups() //everytime new content page is opened, refresh all group relations
}

function shareSelected(fileName){
	document.getElementById('id02').style.display='block'
	document.getElementById('selFileInput').value=fileName
}



</script>

<script>
	var openTab = document.getElementById("firstTab");
	openTab.click();
</script>

</body>
</html> 

